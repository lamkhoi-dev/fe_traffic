<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Widget - IQ Test Traffic Boost</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: white;
      padding: 40px 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 2.5rem;
    }
    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 40px;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .card h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card p {
      color: #ccc;
      line-height: 1.6;
      font-size: 14px;
    }
    .status {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }
    .status.success {
      background: rgba(76, 175, 80, 0.2);
      color: #4CAF50;
    }
    .status.error {
      background: rgba(244, 67, 54, 0.2);
      color: #F44336;
    }
    .status.loading {
      background: rgba(255, 193, 7, 0.2);
      color: #FFC107;
    }
    .status.info {
      background: rgba(102, 126, 234, 0.2);
      color: #667eea;
    }
    .info-box {
      background: #1a1a2e;
      padding: 12px 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 13px;
      color: #4CAF50;
      word-break: break-all;
      margin: 10px 0;
    }
    .test-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      margin-top: 10px;
      margin-right: 10px;
      transition: all 0.2s;
    }
    .test-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    .test-btn.secondary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    .test-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
      font-size: 14px;
    }
    .fingerprint-display {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      border: 1px solid rgba(102, 126, 234, 0.3);
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      text-align: center;
    }
    .fingerprint-value {
      font-family: monospace;
      font-size: 24px;
      font-weight: 700;
      color: #667eea;
      letter-spacing: 2px;
    }
    .fingerprint-label {
      font-size: 12px;
      color: #888;
      margin-top: 5px;
    }
    .log-container {
      background: #0d0d1a;
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
      margin-top: 15px;
    }
    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .log-entry:last-child {
      border-bottom: none;
    }
    .log-time {
      color: #666;
      margin-right: 10px;
    }
    .log-msg {
      color: #ccc;
    }
    .log-msg.success { color: #4CAF50; }
    .log-msg.error { color: #F44336; }
    .log-msg.info { color: #667eea; }
    .log-msg.warn { color: #FFC107; }
    .two-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    @media (max-width: 768px) {
      .two-cols {
        grid-template-columns: 1fr;
      }
    }
    .step-number {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
    }
    .task-info {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
    }
    .task-info p {
      margin: 5px 0;
      font-size: 13px;
    }
    .task-info strong {
      color: #10b981;
    }
    a {
      color: #667eea;
    }
    .clear-btn {
      background: transparent;
      border: 1px solid #666;
      color: #888;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      margin-left: 10px;
    }
    .clear-btn:hover {
      border-color: #F44336;
      color: #F44336;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Test Widget System</h1>
    <p class="subtitle">Ki·ªÉm tra lu·ªìng ho·∫°t ƒë·ªông Widget Traffic Boost</p>

    <!-- Device Fingerprint -->
    <div class="card">
      <h2><span class="step-number">0</span> Device Fingerprint</h2>
      <p>M√£ ƒë·ªãnh danh thi·∫øt b·ªã (gi·ªëng nhau tr√™n c√°c browser kh√°c nhau c√πng thi·∫øt b·ªã)</p>
      <div class="fingerprint-display">
        <div class="fingerprint-value" id="fingerprint-value">Loading...</div>
        <div class="fingerprint-label">Fingerprint c·ªßa thi·∫øt b·ªã n√†y</div>
      </div>
    </div>

    <div class="two-cols">
      <!-- Step 1: API Health -->
      <div class="card">
        <h2><span class="step-number">1</span> Ki·ªÉm tra API</h2>
        <p>Test server backend c√≥ ho·∫°t ƒë·ªông kh√¥ng</p>
        <button class="test-btn" onclick="testHealth()">Test API Health</button>
        <div id="health-result" class="result" style="display: none;"></div>
      </div>

      <!-- Step 2: Create Task -->
      <div class="card">
        <h2><span class="step-number">2</span> Nh·∫≠n nhi·ªám v·ª•</h2>
        <p>T·∫°o task ƒë·ªÉ test widget (m√¥ ph·ªèng user l√†m xong test IQ)</p>
        <button class="test-btn secondary" onclick="createTask()">üéØ Nh·∫≠n nhi·ªám v·ª•</button>
        <div id="task-result" class="result" style="display: none;"></div>
      </div>
    </div>

    <!-- Step 3: Check on Target Site -->
    <div class="card">
      <h2><span class="step-number">3</span> Ki·ªÉm tra tr√™n trang ƒë√≠ch</h2>
      <p>Sau khi nh·∫≠n nhi·ªám v·ª•, m·ªü trang ƒë√≠ch ƒë·ªÉ xem widget c√≥ xu·∫•t hi·ªán kh√¥ng</p>
      <div id="target-site-info" style="display: none;">
        <div class="task-info">
          <p>üìå <strong>Site:</strong> <span id="site-name">-</span></p>
          <p>üîó <strong>URL:</strong> <a id="site-url" href="#" target="_blank">-</a></p>
          <p>üîë <strong>Site Key:</strong> <code id="site-key">-</code></p>
        </div>
        <p style="margin-top: 10px; color: #888; font-size: 13px;">
          ‚ö†Ô∏è M·ªü link tr√™n <strong>c√πng thi·∫øt b·ªã n√†y</strong> ƒë·ªÉ widget hi·ªán l√™n. N·∫øu m·ªü tr√™n thi·∫øt b·ªã kh√°c, widget s·∫Ω kh√¥ng xu·∫•t hi·ªán.
        </p>
      </div>
      <button class="test-btn" onclick="openTargetSite()" id="open-site-btn" disabled>üåê M·ªü trang ƒë√≠ch</button>
    </div>

    <!-- Step 4: Verify Code -->
    <div class="card">
      <h2><span class="step-number">4</span> X√°c nh·∫≠n m√£</h2>
      <p>Sau khi l·∫•y ƒë∆∞·ª£c m√£ t·ª´ trang ƒë√≠ch, nh·∫≠p v√†o ƒë√¢y ƒë·ªÉ x√°c nh·∫≠n</p>
      <div style="display: flex; gap: 10px; margin-top: 15px;">
        <input type="text" id="verify-code" placeholder="Nh·∫≠p m√£ x√°c nh·∫≠n (VD: ABC123)" 
          style="flex: 1; padding: 12px 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); 
          background: rgba(0,0,0,0.3); color: white; font-size: 16px; font-family: monospace; 
          letter-spacing: 2px; text-transform: uppercase;">
        <button class="test-btn secondary" onclick="verifyCode()">‚úÖ X√°c nh·∫≠n</button>
      </div>
      <div id="verify-result" class="result" style="display: none;"></div>
    </div>

    <!-- Debug Log -->
    <div class="card">
      <h2>
        üìã Debug Log
        <button class="clear-btn" onclick="clearLog()">Clear</button>
      </h2>
      <div class="log-container" id="log-container">
        <div class="log-entry">
          <span class="log-time">--:--:--</span>
          <span class="log-msg info">Waiting for actions...</span>
        </div>
      </div>
    </div>

    <!-- Script embed code -->
    <div class="card">
      <h2>üìù M√£ nh√∫ng Widget</h2>
      <p>Copy ƒëo·∫°n code n√†y v√†o footer c·ªßa trang ƒë√≠ch:</p>
      <div class="info-box" id="embed-code">&lt;script src="https://betraffic-production.up.railway.app/widget.js?siteKey=SITE_ME4MZQ29"&gt;&lt;/script&gt;</div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://betraffic-production.up.railway.app';
    const DEFAULT_SITE_KEY = 'SITE_ME4MZQ29'; // Site chouchouphuquoc
    
    let currentTask = null;

    // Generate fingerprint (same algorithm as widget)
    // Ch·ªâ d√πng c√°c thu·ªôc t√≠nh ·ªîN ƒê·ªäNH - kh√¥ng thay ƒë·ªïi theo zoom/c·ª≠a s·ªï
    // ƒê√É B·ªé: devicePixelRatio v√¨ n√≥ thay ƒë·ªïi theo browser zoom level
    function getFingerprint() {
      const dataArray = [
        screen.width,           // ƒê·ªô ph√¢n gi·∫£i m√†n h√¨nh - ·ªïn ƒë·ªãnh
        screen.height,          // ƒê·ªô ph√¢n gi·∫£i m√†n h√¨nh - ·ªïn ƒë·ªãnh
        screen.colorDepth,      // ƒê·ªô s√¢u m√†u - ph·∫ßn c·ª©ng
        Intl.DateTimeFormat().resolvedOptions().timeZone,  // Timezone - h·ªá th·ªëng
        new Date().getTimezoneOffset(),  // Timezone offset - h·ªá th·ªëng
        navigator.hardwareConcurrency || 0,  // CPU cores - ph·∫ßn c·ª©ng
        navigator.maxTouchPoints || 0   // Touch support - ph·∫ßn c·ª©ng
      ];
      
      const data = dataArray.join('|');
      
      // Debug log ƒë·ªÉ xem raw data
      console.log('[Test Widget DEBUG] Fingerprint raw data:', {
        screenWidth: screen.width,
        screenHeight: screen.height,
        colorDepth: screen.colorDepth,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        timezoneOffset: new Date().getTimezoneOffset(),
        hardwareConcurrency: navigator.hardwareConcurrency || 0,
        maxTouchPoints: navigator.maxTouchPoints || 0,
        joinedString: data
      });

      let hash = 0;
      for (let i = 0; i < data.length; i++) {
        const char = data.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      
      const fp = 'FP_' + Math.abs(hash).toString(36).toUpperCase();
      console.log('[Test Widget DEBUG] Generated fingerprint:', fp);
      return fp;
    }

    // Logger
    function addLog(msg, type = 'info') {
      const container = document.getElementById('log-container');
      const time = new Date().toLocaleTimeString('vi-VN');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `
        <span class="log-time">${time}</span>
        <span class="log-msg ${type}">${msg}</span>
      `;
      container.appendChild(entry);
      container.scrollTop = container.scrollHeight;
      
      // Also log to console
      console.log(`[${time}] ${msg}`);
    }

    function clearLog() {
      document.getElementById('log-container').innerHTML = `
        <div class="log-entry">
          <span class="log-time">${new Date().toLocaleTimeString('vi-VN')}</span>
          <span class="log-msg info">Log cleared</span>
        </div>
      `;
    }

    // Display fingerprint
    function displayFingerprint() {
      const fp = getFingerprint();
      document.getElementById('fingerprint-value').textContent = fp;
      addLog(`Device Fingerprint: ${fp}`, 'info');
      return fp;
    }

    // Test API Health
    async function testHealth() {
      const resultDiv = document.getElementById('health-result');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<span class="status loading">‚è≥ ƒêang ki·ªÉm tra...</span>';
      addLog('Testing API health...', 'info');

      try {
        const start = Date.now();
        const response = await fetch(`${API_BASE}/api/health`);
        const data = await response.json();
        const latency = Date.now() - start;

        if (data.status === 'ok') {
          resultDiv.innerHTML = `
            <span class="status success">‚úÖ Server OK</span>
            <p style="margin-top: 8px; font-size: 12px; color: #888;">
              Latency: ${latency}ms | Time: ${new Date(data.timestamp).toLocaleString('vi-VN')}
            </p>
          `;
          addLog(`‚úÖ API Health OK - Latency: ${latency}ms`, 'success');
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">‚ùå L·ªói k·∫øt n·ªëi</span>
          <p style="margin-top: 8px; font-size: 12px; color: #F44336;">${error.message}</p>
        `;
        addLog(`‚ùå API Health failed: ${error.message}`, 'error');
      }
    }

    // Create Task
    async function createTask() {
      const resultDiv = document.getElementById('task-result');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<span class="status loading">‚è≥ ƒêang t·∫°o nhi·ªám v·ª•...</span>';
      
      const fingerprint = getFingerprint();
      addLog(`Creating task with fingerprint: ${fingerprint}`, 'info');

      try {
        const response = await fetch(`${API_BASE}/api/tasks/create-test`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            fingerprint: fingerprint,
            siteKey: DEFAULT_SITE_KEY
          })
        });

        const data = await response.json();
        addLog(`Response: ${JSON.stringify(data)}`, 'info');

        if (data.success) {
          currentTask = data.task;
          
          resultDiv.innerHTML = `
            <span class="status success">‚úÖ Nhi·ªám v·ª• ƒë√£ t·∫°o!</span>
            <div class="task-info" style="margin-top: 10px;">
              <p>üìå <strong>Task ID:</strong> ${data.task._id}</p>
              <p>üìä <strong>Status:</strong> ${data.task.status}</p>
            </div>
          `;
          
          // Update target site info
          document.getElementById('target-site-info').style.display = 'block';
          document.getElementById('site-name').textContent = data.task.siteName || 'Chou Chou Phu Quoc';
          document.getElementById('site-url').textContent = data.task.siteUrl || 'https://chouchouphuquoc.com.vn/';
          document.getElementById('site-url').href = data.task.siteUrl || 'https://chouchouphuquoc.com.vn/';
          document.getElementById('site-key').textContent = data.task.siteKey || DEFAULT_SITE_KEY;
          document.getElementById('open-site-btn').disabled = false;
          
          addLog(`‚úÖ Task created: ${data.task._id}`, 'success');
          addLog(`üåê Target site: ${data.task.siteName}`, 'info');
        } else {
          resultDiv.innerHTML = `
            <span class="status error">‚ùå L·ªói</span>
            <p style="margin-top: 8px; font-size: 12px; color: #F44336;">${data.message}</p>
          `;
          addLog(`‚ùå Create task failed: ${data.message}`, 'error');
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">‚ùå L·ªói k·∫øt n·ªëi</span>
          <p style="margin-top: 8px; font-size: 12px; color: #F44336;">${error.message}</p>
        `;
        addLog(`‚ùå Create task error: ${error.message}`, 'error');
      }
    }

    // Open target site
    function openTargetSite() {
      const url = document.getElementById('site-url').href;
      addLog(`Opening target site: ${url}`, 'info');
      addLog(`‚ö†Ô∏è Widget should appear on target site if fingerprint matches`, 'warn');
      window.open(url, '_blank');
    }

    // Verify Code
    async function verifyCode() {
      const code = document.getElementById('verify-code').value.trim().toUpperCase();
      const resultDiv = document.getElementById('verify-result');
      
      if (!code) {
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<span class="status error">‚ùå Vui l√≤ng nh·∫≠p m√£ x√°c nh·∫≠n</span>';
        return;
      }

      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<span class="status loading">‚è≥ ƒêang x√°c nh·∫≠n...</span>';
      
      const fingerprint = getFingerprint();
      addLog(`Verifying code: ${code} with fingerprint: ${fingerprint}`, 'info');

      try {
        const response = await fetch(`${API_BASE}/api/codes/verify`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            code: code,
            fingerprint: fingerprint
          })
        });

        const data = await response.json();
        addLog(`Verify response: ${JSON.stringify(data)}`, 'info');

        if (data.success) {
          resultDiv.innerHTML = `
            <span class="status success">‚úÖ M√£ h·ª£p l·ªá!</span>
            <div class="task-info" style="margin-top: 10px;">
              <p>üéâ <strong>X√°c nh·∫≠n th√†nh c√¥ng!</strong></p>
              <p>üìä Task ƒë√£ ho√†n th√†nh</p>
            </div>
          `;
          addLog(`‚úÖ Code verified successfully!`, 'success');
          
          // Clear input
          document.getElementById('verify-code').value = '';
        } else {
          resultDiv.innerHTML = `
            <span class="status error">‚ùå ${data.message || 'M√£ kh√¥ng h·ª£p l·ªá'}</span>
          `;
          addLog(`‚ùå Code verification failed: ${data.message}`, 'error');
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <span class="status error">‚ùå L·ªói k·∫øt n·ªëi</span>
          <p style="margin-top: 8px; font-size: 12px; color: #F44336;">${error.message}</p>
        `;
        addLog(`‚ùå Verify error: ${error.message}`, 'error');
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      displayFingerprint();
      addLog('Page loaded - Ready to test', 'success');
    });
  </script>
</body>
</html>
</attachment>
</attachments>
<context>
The current date is January 30, 2026.
Terminals:
Terminal: powershell
Terminal: powershell
Last Command: npm i
Cwd: D:\An\IQ_test_traficBoost\client
Exit Code: 0

</context>
<editorContext>
The user's current file is d:\An\IQ_test_traficBoost\client\.gitignore. 
</editorContext>
<reminderInstructions>
You are an agent - you must keep going until the user's query is completely resolved, before ending your turn and yielding back to the user. ONLY terminate your turn when you are sure that the problem is solved, or you absolutely cannot continue.
You take action when possible- the user is expecting YOU to take action and go to work for them. Don't ask unnecessary questions about the details if you can simply DO something useful instead.

</reminderInstructions>
<userRequest>
gi·ªù t√¥i mu·ªën deply fe l√™n vercel, b·∫°n h·ªó tr·ª£ t√¥i nh√©, l∆∞u √Ω move test html qua fe v√† t·∫°o 1 trang ri√™ng hi·ªán trang html test ƒë√≥ ƒë·ªÉ test khi deploy nh√©, l√†m kƒ© tr√°nh l·ªói c√≥ g√¨ c·∫ßn h·ªèi c·ª© h·ªèi t√¥i, t√¥i ƒë√£ push v√† link v·ªõi remote repo r·ªìi
</userRequest>
